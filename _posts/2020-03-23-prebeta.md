---
layout: post
author: Michael Tilbury
title: Alpha to Pre-Beta Sprint
snippet: These past few weeks were stressful, but I was able to get contributions in for the enemy death component and enemy balance editor script.
---
## At a Glance
The first week in this sprint was spring break, and instead of getting new tasks we worked on finishing up things from the previous sprint. During this time, I worked on the EnemyDeath component which handles behavior when the player kills an enemy. My next task was an editor script to help level designers determine the relative "difficulty" of a level based on the number of certain enemies. This took longer than expected due to the campus shutdown and sudden move-out.
* Wrote enemy death script
  * Runs when any enemy dies. Despawns it, shows a corpse, and plays a particle effect
* Created enemy balance editor script
  * Uses a formula adapted from Alex Kisil's research during DreamWillow
  * Finds all enemies in the scene and calculates their difficulty score
    * Difficulty is defined by attributes like hitbox size, firing rate, etc.
  * Shows this information in an editor window to help level designers
* Attended two meetings
  * One was in-person at the usual time, one was cancelled, and the other happened over Discord voice chat

## Enemy Death Script
The EnemyDeath component is designed to define the basic behaviors that all enemies will carry out when the player kills them. It needs to despawn the enemy, show a corpse sprite, and play a particle effect. This was pretty straightforward, but I did spend some time taking feedback and modifying the design to allow for more flexibility. At the time I was writing this script, there were no finished enemy prefabs to use in testing. I had to use the basic LAB_EnemyPrototype which is a relic from the first days of the project. This meant my code made assumptions on the structure of all enemy prefabs based on just this one.

My plan was to have public fields for the particle effect and corpse prefabs, and have them spawn at the enemy's location before destroying its GameObject. There was a problem though, because the actual enemy was a child of the root prefab element. This parent just acted as a container, while the child had all of the relevant components and scripts attached. If I put the death script on the child and destroyed it on death, it raised lots of errors because the AggroRange and other siblings had references to a deleted GameObject they were trying to access.

<div>
<code class="highlight" style="margin-left: auto; margin-right: auto; width: 200px; display: block">
<pre>
LAB_EnemyPrototype
├── <span style="color: #e83e8c">LAB_Enemy (Patrol)</span>
│   └── Visuals
├── EnemyAggroRange
├── Left Bound
└── Right Bound
</pre>
</code>
<p class="figure-caption text-center" style="max-width: 500px; margin-left: auto; margin-right: auto">The enemy object hierarchy, with the EnemyDeath component on a child of the root prefab element.</p>
</div>

To fix this, I had the death component delete the parent of the object the script is attached to. I was already thinking ahead at this point and was worried that future prefabs may not fit this mold, so I added a conditional: if the enemy has a parent, delete that, otherwise, just delete the enemy. At this point, the script worked so I put in a pull request. I did get feedback that this wasn't the best way of doing it. Even though I was trying to fit a few cases, it was possible that future enemies could be nested further which would break the code. It still wasn't flexible.

<div>
<code class="highlight" style="margin-left: auto; margin-right: auto; width: 200px; display: block">
<pre>
<span style="color: #e83e8c">LAB_EnemyPrototype</span>
├── LAB_Enemy (Patrol)
│   └── Visuals
├── EnemyAggroRange
├── Left Bound
└── Right Bound
</pre>
</code>
<p class="figure-caption text-center" style="max-width: 500px; margin-left: auto; margin-right: auto">The EnemyDeath component is now on the root element.</p>
</div>

I moved the component to the root element. The parent's position doesn't move with the enemy, so it needs a way to get the enemy's position to know where to spawn the corpe and particle effect. My first solution was to iterate through the children and do a name search which I recognized as messy and bad. I decided to just add two additional public properties for the corpse and particle effect spawn locations. In the interest of making the code as flexible as possible for future enemies, I thought it made sense to be able to set the spawn locations independently anyway. If a designer wants to have the effect happen at somewhere that's not exactly at the enemy's center point, they should have that power. And if they do want it exactly at the enemy's center, that's the default since both fields are set to the child enemy in the prefab editor.

<div class="image-container text-center">
<video width="400" style="margin: none" alt="The player kills an enemy. A particle effect plays, and the enemy becomes a corpse." loop autoplay>
  <source src="/assets/images/preBeta/EnemyDeath1.mp4" type="video/mp4">
</video>
<p class="figure-caption">The finished EnemyDeath component in action: spawning a corpse and particle effect when the player kills it.</p>
</div>

Finally, I did some experimenting with how other types of enemies could die. For this basic walking enemy, the basic corpse sprite with no collider is enough. The player can walk through it as if it's in the background. However, I wanted to make sure this could work with flying enemies. Each enemy can use a unique corpse prefab, so I created one with a rigidbody and collider so it would fall to the ground on death. I gave it a tag that wouldn't interact or block the player. I did this in a separate local branch since changes to the tags list and physics matrix would cause problems if it got merged. This was meant as more of a proof-of-concept so the team would know it works with flying enemies.

<div class="image-container text-center">
<video width="400" style="margin: none" alt="A flying enemy falls to the ground after being killed." loop autoplay>
  <source src="/assets/images/preBeta/EnemyDeath2.mp4" type="video/mp4">
</video>
<p class="figure-caption">A flying enemy falls to the ground after being killed.</p>
</div>

## Enemy Balance Editor Script

#### Design Decisions