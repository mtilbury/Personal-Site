---
layout: post
author: Michael Tilbury
title: Io Progress Report - The Final Sprint
snippet: This was the last sprint before our final deliverable. I was tasked with implementing player damage, which was urgently important for playtesting the game before the showcase. I also had to fix a game-breaking bug in the Acrobat's damage-box.
---
## At a Glance
##### Week One
* 5 hours implementing player damage into the game
  * Much of the code for player damage was already written but was not working
  * Time was spent understanding code and playtesting to tune damage values of enemies, projectiles
  * Had a problem with jumping after pulling from development, had to remake entire test scene
* 4 hours spent integrating and polishing enemy editor UI script from previous sprints
  * Added button to toggle indicator circles
  * Prevented location markers from being saved in the scene, causing conflicts
* 2 Hours in Meeting 4/12
  * Includes playtesting time

##### Week Two
* 3 hours spent fixing Acrobat enemy
  * The enemy caused damage when the player entered its aggro range, making it almost impossible to progress
* 2 hours in meeting 4/19
  * Includes playing final build
<!-- * 2 Hours writing devblog -->
* Will be spending time at the showcase

## Player Damage
After investigating the codebase I found three scripts which implement enemies causing damage to the player: `DamageOnCollision`, `DamageOnTrigger`, and `Health`, all of which were written by different people. I created a test scene with all the different enemies and projectiles. It was unclear if the player was taking damage at this point. All of the scripts seemed to be in place. I made a quick health counter UI to see if the player was taking damage, and they were not.

<div class="image-container text-center">
<video width="600" style="margin: none" alt="The player jumps on every enemy in the game and never takes damage." loop autoplay>
  <source src="/assets/images/gold/NoDamage.mp4" type="video/mp4">
</video>
<p class="figure-caption">The player is hit by each enemy but does not take damage.</p>
</div>

It took me longer than I'd like to admit to figure out the reason it wasn't working: the `DamageOnCollision` component has a LayerMask property that has to be set to check collisions with the `Player` layer. I just assumed that it would have been already set properly. Once I changed that, the player was now taking damage. However, they took damage from the enemy's aggro trigger. 

<div class="image-container text-center">
<video width="600" style="margin: none" alt="The player takes a point of damage when they enter an enemy's aggro range." loop autoplay>
  <source src="/assets/images/gold/AllAggroDamage.mp4" type="video/mp4">
</video>
<p class="figure-caption">The player takes a point of damage when they enter an enemy's aggro radius (visualized in yellow).</p>
</div>

This has been a thorn in my side ever since I worked on the aggro component, and it keeps coming back to haunt me. From previous encounters, I knew the solution is to reorganize the prefabs. If I put the enemy's collider and the `DamageOnCollision` onto a new childed GameObject, it would work properly. Halfway through doing this I realized that this shouldn't be happening in the first place. Like I said earlier, there are two damage components. `DamageOnCollision` handles damage via `OnCollisionEnter` while `DamageOnTrigger` handles damage via `OnTriggerEnter`. The aggro range is a trigger, so why was it causing damage in the component that checks for *collider* collisions? The author of the `DamageOnCollision` script had mistakenly implemented the function `OnTriggerEnter`. I removed this and now the aggro no longer caused problems, and I didn't have to reorganize all the enemy prefabs.

Also, in the video you can see that the player takes *continuous* damage when they're in contact with the enemy. I added i-frames to the player so they would have some invincibility. The rest of the time was spent tuning damage values on enemies/projectiles and the number of i-frames on enemies/the player.

## EnemyBalance Editor Tweaks

## Fixing the Acrobat

## Looking Back
